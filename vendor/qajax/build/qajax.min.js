/*! qajax 0.2.3 - Simple Promise ajax library based on Q */
!function(a){var b;"object"==typeof exports?(b=require("q"),module.exports=a(b)):"function"==typeof define&&define.amd?define(["q"],a):(b=window.Q,window.Qajax=a(b))}(function(a){"use strict";function b(a,b){return a in b?b[a]:g.defaults[a]}function c(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a}function d(a){var b,c=[];for(b in a)a.hasOwnProperty(b)&&c.push(encodeURIComponent(b)+"="+encodeURIComponent(a[b]));return c.join("&")}function e(a){return-1===a.indexOf("?")}function f(a){g.defaults.logs&&window.console&&console.log(a)}var g=function(){var g,i=arguments;if(!i.length)throw new Error("Qajax: settings are required");if("string"==typeof i[0])g="object"==typeof i[1]&&i[1]||{},g.url=i[0];else{if("object"!=typeof i[0])throw new Error("Qajax: settings must be an object");g=i[0]}if(!g.url)throw new Error("Qajax: settings.url is required");if("cancellation"in g&&!a.isPromiseAlike(g.cancellation))throw new Error("cancellation must be a Promise.");var j=new XMLHttpRequest,k=g.cancellation||a.defer().promise,l=b("method",g),m=b("base",g),n=g.url,o=g.data,p=g.responseType,q=g.params||{},r=a.defer(),s=b("timeout",g),t=c({},b("headers",g)),u=b("cache",g);u&&(q[u===!0?"_":u]=(new Date).getTime()),m&&(n=m+n);var v=d(q);return v&&(n=n+(e(n)?"?":"&")+v),null!==o&&"object"==typeof o&&(h in t||(t[h]="application/json"),o=JSON.stringify(o)),a.fcall(function(){j.onreadystatechange=function(){if(4===j.readyState)try{f(l+" "+n+" => "+j.status),j.status?r.resolve(j):r.reject(j)}catch(a){r.reject(j)}},j.onprogress=function(a){r.notify(a)},j.open(l,n,!0),p&&(j.responseType=p);for(var a in t)t.hasOwnProperty(a)&&j.setRequestHeader(a,t[a]);return void 0!==o&&null!==o?j.send(o):j.send(),k.fin(function(){r.promise.isFulfilled()||(f("Qajax cancellation reached."),j.abort())}),s?r.promise.timeout(s).fail(function(a){throw a instanceof Error&&(f("Qajax request delay reach in "+l+" "+n),j.abort()),j}):r.promise})};g.TIMEOUT=void 0,g.defaults={logs:!1,timeout:6e4,cache:window.ActiveXObject||"ActiveXObject"in window,method:"GET",headers:{},base:""},g.filterStatus=function(b){var c,d;if(d=typeof b,"function"===d)c=b;else{if("number"!==d)throw"validStatus type "+d+" unsupported";c=function(a){return a===b}}return function(b){var d=0;try{d=b.status}catch(e){f("Qajax: failed to read xhr.status")}return 1223===d&&(d=204),c(d)?a.resolve(b):a.reject(b)}},g.filterSuccess=g.filterStatus(function(a){return a>=200&&300>a||304===a}),g.toJSON=function(b){return a.fcall(function(){return JSON.parse(b.responseText)})},g.getJSON=function(a){return g({url:a,method:"GET"}).then(g.filterSuccess).then(g.toJSON)},g.serialize=d;var h="Content-Type";return g});